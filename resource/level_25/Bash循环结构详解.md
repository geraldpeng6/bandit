# Bash循环结构详解 🔄

## 什么是循环？ 🤔

循环是编程中的基本概念，它允许我们重复执行一组命令，直到满足特定条件为止。在Bash脚本中，循环结构是自动化重复任务的强大工具，可以帮助我们处理文件列表、批量操作和数据处理等任务。

## Bash中的循环类型 📋

Bash提供了三种主要的循环结构：
1. `for`循环 - 遍历列表中的元素
2. `while`循环 - 当条件为真时重复执行
3. `until`循环 - 直到条件为真时停止执行

让我们详细了解每种循环结构！

## for循环 🔁

`for`循环是Bash中最常用的循环结构，它遍历一个列表中的每个元素并执行指定的命令。

### 基本语法

```bash
for 变量 in 列表
do
    命令1
    命令2
    ...
done
```

### 示例1：遍历数字

```bash
#!/bin/bash
# 遍历数字1到5
for 数字 in 1 2 3 4 5
do
    echo "当前数字是: $数字"
done
```

输出：
```
当前数字是: 1
当前数字是: 2
当前数字是: 3
当前数字是: 4
当前数字是: 5
```

### 示例2：使用序列生成器

```bash
#!/bin/bash
# 使用序列生成器{起始..结束}
for 数字 in {1..5}
do
    echo "当前数字是: $数字"
done
```

### 示例3：带步长的序列

```bash
#!/bin/bash
# 使用序列生成器{起始..结束..步长}（Bash 4.0及以上版本支持）
for 数字 in {1..10..2}  # 1,3,5,7,9
do
    echo "当前数字是: $数字"
done
```

### 示例4：遍历文件

```bash
#!/bin/bash
# 遍历当前目录中的所有txt文件
for 文件 in *.txt
do
    echo "处理文件: $文件"
    # 这里可以添加对文件的操作
done
```

### 示例5：C风格的for循环

```bash
#!/bin/bash
# C风格的for循环
for ((i=1; i<=5; i++))
do
    echo "计数: $i"
done
```

## while循环 🔄

`while`循环在指定的条件为真时重复执行命令。

### 基本语法

```bash
while [ 条件 ]
do
    命令1
    命令2
    ...
done
```

### 示例1：基本计数器

```bash
#!/bin/bash
# 使用while循环计数
计数=1
while [ $计数 -le 5 ]
do
    echo "计数: $计数"
    计数=$((计数+1))
done
```

输出：
```
计数: 1
计数: 2
计数: 3
计数: 4
计数: 5
```

### 示例2：读取文件内容

```bash
#!/bin/bash
# 逐行读取文件内容
while read 行
do
    echo "读取到: $行"
done < 文件名.txt
```

### 示例3：无限循环

```bash
#!/bin/bash
# 无限循环（需要在循环内部有退出条件）
while true
do
    echo "这是一个无限循环，按Ctrl+C退出"
    sleep 1
done
```

## until循环 🔄

`until`循环与`while`循环相反，它在指定的条件为假时重复执行命令，直到条件变为真。

### 基本语法

```bash
until [ 条件 ]
do
    命令1
    命令2
    ...
done
```

### 示例：计数到5

```bash
#!/bin/bash
# 使用until循环计数到5
计数=1
until [ $计数 -gt 5 ]
do
    echo "计数: $计数"
    计数=$((计数+1))
done
```

输出：
```
计数: 1
计数: 2
计数: 3
计数: 4
计数: 5
```

## 循环控制语句 🎮

Bash提供了几个命令来控制循环的执行流程：

### break - 跳出循环

`break`命令用于立即退出当前循环。

```bash
#!/bin/bash
# 使用break跳出循环
for 数字 in {1..10}
do
    echo "当前数字: $数字"
    if [ $数字 -eq 5 ]
    then
        echo "达到5，跳出循环！"
        break
    fi
done
echo "循环结束"
```

输出：
```
当前数字: 1
当前数字: 2
当前数字: 3
当前数字: 4
当前数字: 5
达到5，跳出循环！
循环结束
```

### continue - 跳过当前迭代

`continue`命令用于跳过当前迭代，直接进入下一次循环。

```bash
#!/bin/bash
# 使用continue跳过偶数
for 数字 in {1..10}
do
    # 检查是否为偶数
    if [ $((数字 % 2)) -eq 0 ]
    then
        echo "跳过偶数: $数字"
        continue
    fi
    echo "处理奇数: $数字"
done
```

输出：
```
处理奇数: 1
跳过偶数: 2
处理奇数: 3
跳过偶数: 4
处理奇数: 5
跳过偶数: 6
处理奇数: 7
跳过偶数: 8
处理奇数: 9
跳过偶数: 10
```

## 嵌套循环 🔄🔄

循环可以嵌套在其他循环内部，创建更复杂的结构。

```bash
#!/bin/bash
# 嵌套循环示例 - 生成乘法表
for i in {1..5}
do
    for j in {1..5}
    do
        结果=$((i * j))
        echo -n "$i × $j = $结果  "
    done
    echo "" # 换行
done
```

输出：
```
1 × 1 = 1  1 × 2 = 2  1 × 3 = 3  1 × 4 = 4  1 × 5 = 5  
2 × 1 = 2  2 × 2 = 4  2 × 3 = 6  2 × 4 = 8  2 × 5 = 10  
3 × 1 = 3  3 × 2 = 6  3 × 3 = 9  3 × 4 = 12  3 × 5 = 15  
4 × 1 = 4  4 × 2 = 8  4 × 3 = 12  4 × 4 = 16  4 × 5 = 20  
5 × 1 = 5  5 × 2 = 10  5 × 3 = 15  5 × 4 = 20  5 × 5 = 25  
```

## 实际应用示例 🛠️

### 示例1：批量重命名文件

```bash
#!/bin/bash
# 批量将当前目录中的.txt文件重命名为.bak
for 文件 in *.txt
do
    新文件名="${文件%.txt}.bak"
    echo "重命名 $文件 为 $新文件名"
    mv "$文件" "$新文件名"
done
```

### 示例2：监控系统资源

```bash
#!/bin/bash
# 每5秒监控一次系统资源
while true
do
    echo "===== $(date) ====="
    echo "CPU使用率:"
    top -bn1 | grep "Cpu(s)" | awk '{print $2 + $4}'
    echo "内存使用情况:"
    free -m | grep "Mem:"
    echo "----------------------"
    sleep 5
done
```

### 示例3：暴力破解PIN码（仅用于教育目的）

```bash
#!/bin/bash
# 尝试所有可能的4位PIN码
for pin in {0000..9999}
do
    echo "尝试PIN码: $pin"
    # 这里可以添加验证PIN码的命令
    # 如果成功，使用break退出循环
done
```

## 性能考虑 ⚡

在编写循环时，需要考虑性能问题，特别是当处理大量数据时：

1. **避免不必要的命令执行** - 将不变的操作移到循环外部
2. **使用内置命令** - 内置命令比外部命令执行更快
3. **考虑使用并行处理** - 对于独立的任务，可以考虑使用`&`在后台并行执行
4. **优化循环条件** - 确保循环条件尽可能简单和高效

## 调试循环 🐞

调试循环的技巧：

1. 使用`echo`语句打印变量值
2. 使用`set -x`启用调试模式，显示每个命令的执行
3. 对于复杂循环，可以先用小数据集测试
4. 使用`PS4='${LINENO}: '`设置调试提示符，显示行号

```bash
#!/bin/bash
# 调试循环示例
set -x  # 启用调试模式
for i in {1..3}
do
    echo "迭代 $i"
    for j in {1..2}
    do
        echo "  内部循环 $j"
    done
done
set +x  # 禁用调试模式
```

## 练习题 🎯

1. 编写一个脚本，计算1到100之间所有偶数的和。
2. 创建一个脚本，接受一个目录路径作为参数，并计算该目录中所有文件的总大小。
3. 编写一个脚本，生成斐波那契数列的前20个数。
4. 创建一个脚本，检查1到100之间的所有数字，并输出所有的质数。
5. 编写一个脚本，模拟简单的倒计时器，从用户输入的数字开始倒数到0。

## 小贴士 💡

- 在处理文件名时，始终使用引号包围变量，以处理包含空格的文件名
- 对于简单的循环，可以使用一行命令：`for i in {1..5}; do echo $i; done`
- 使用`$((...))`进行算术运算，而不是`expr`命令
- 记住`break`和`continue`可以带数字参数，指定要跳出或继续的循环层级
- 在处理大量迭代时，考虑使用进度指示器提供反馈

通过掌握Bash循环结构，你可以大大提高脚本的功能和效率，自动化各种重复任务。循环是Bash脚本中最强大的工具之一，值得深入学习和实践！
