# Vi/Vim编辑器命令详解 ✏️

## 什么是Vi/Vim？ 🤔

Vi是Unix系统中最古老且最强大的文本编辑器之一，而Vim（Vi IMproved）是Vi的增强版本，提供了更多功能和改进。尽管学习曲线较陡，但一旦掌握，Vi/Vim可以成为编辑文本和代码的高效工具。它的最大特点是完全可以通过键盘操作，无需使用鼠标，大大提高了编辑效率。

## 为什么学习Vi/Vim？ 🌟

1. **普遍存在** - 几乎所有Unix/Linux系统都预装了Vi
2. **高效编辑** - 完全键盘操作，无需鼠标
3. **可定制性** - 高度可配置，适应个人需求
4. **轻量级** - 资源占用少，适合远程服务器操作
5. **强大功能** - 支持语法高亮、代码折叠、宏录制等

## Vi/Vim的模式 🔄

Vi/Vim有三种主要模式，理解这些模式是掌握Vi/Vim的关键：

1. **普通模式（Normal Mode）** - 默认模式，用于导航和执行命令
2. **插入模式（Insert Mode）** - 用于输入和编辑文本
3. **命令行模式（Command-line Mode）** - 用于执行保存、退出等操作

此外，还有：
4. **可视模式（Visual Mode）** - 用于选择文本块
5. **替换模式（Replace Mode）** - 用于替换现有文本

## 基本操作 🔍

### 启动Vi/Vim

```bash
# 打开文件
vim 文件名

# 打开多个文件
vim 文件1 文件2

# 在特定行打开文件
vim +行号 文件名

# 在匹配模式处打开文件
vim +/搜索模式 文件名
```

### 模式切换

| 按键 | 动作 |
|------|------|
| `i` | 在光标位置前进入插入模式 |
| `I` | 在行首进入插入模式 |
| `a` | 在光标位置后进入插入模式 |
| `A` | 在行尾进入插入模式 |
| `o` | 在当前行下方新建一行并进入插入模式 |
| `O` | 在当前行上方新建一行并进入插入模式 |
| `Esc` | 从任何模式返回到普通模式 |
| `:` | 从普通模式进入命令行模式 |

### 退出Vi/Vim

| 命令 | 动作 |
|------|------|
| `:q` | 退出（如果没有修改） |
| `:q!` | 强制退出，不保存修改 |
| `:w` | 保存文件 |
| `:wq` 或 `:x` | 保存并退出 |
| `ZZ` | 保存并退出（普通模式下） |
| `ZQ` | 不保存退出（普通模式下） |

## 导航命令 🧭

### 基本移动

| 按键 | 动作 |
|------|------|
| `h` | 左移一个字符 |
| `j` | 下移一行 |
| `k` | 上移一行 |
| `l` | 右移一个字符 |
| `w` | 移动到下一个单词的开头 |
| `e` | 移动到当前或下一个单词的结尾 |
| `b` | 移动到当前或上一个单词的开头 |
| `0` | 移动到行首 |
| `^` | 移动到行首第一个非空白字符 |
| `$` | 移动到行尾 |

### 页面导航

| 按键 | 动作 |
|------|------|
| `Ctrl+f` | 向下翻页 |
| `Ctrl+b` | 向上翻页 |
| `Ctrl+d` | 向下翻半页 |
| `Ctrl+u` | 向上翻半页 |
| `gg` | 跳到文件开头 |
| `G` | 跳到文件末尾 |
| `数字G` | 跳到指定行号 |
| `H` | 跳到屏幕顶部 |
| `M` | 跳到屏幕中间 |
| `L` | 跳到屏幕底部 |

## 编辑命令 ✏️

### 插入和删除

| 按键 | 动作 |
|------|------|
| `x` | 删除当前字符 |
| `X` | 删除光标前的字符 |
| `dd` | 删除当前行 |
| `dw` | 删除从光标到单词结尾 |
| `d$` 或 `D` | 删除从光标到行尾 |
| `d0` | 删除从光标到行首 |
| `数字dd` | 删除多行 |
| `yy` | 复制当前行 |
| `yw` | 复制从光标到单词结尾 |
| `y$` | 复制从光标到行尾 |
| `数字yy` | 复制多行 |
| `p` | 在光标后粘贴 |
| `P` | 在光标前粘贴 |

### 撤销和重做

| 按键 | 动作 |
|------|------|
| `u` | 撤销上一次操作 |
| `Ctrl+r` | 重做上一次撤销的操作 |
| `.` | 重复上一次操作 |

## 搜索和替换 🔎

### 搜索

| 命令 | 动作 |
|------|------|
| `/模式` | 向下搜索指定模式 |
| `?模式` | 向上搜索指定模式 |
| `n` | 重复上一次搜索（同方向） |
| `N` | 重复上一次搜索（反方向） |
| `*` | 向下搜索光标下的单词 |
| `#` | 向上搜索光标下的单词 |

### 替换

| 命令 | 动作 |
|------|------|
| `:s/旧/新/` | 替换当前行第一个匹配 |
| `:s/旧/新/g` | 替换当前行所有匹配 |
| `:%s/旧/新/g` | 替换整个文件所有匹配 |
| `:%s/旧/新/gc` | 替换整个文件所有匹配，但每次替换前询问 |
| `:起始行,结束行s/旧/新/g` | 替换指定范围内所有匹配 |

## 高级功能 🚀

### 多文件操作

| 命令 | 动作 |
|------|------|
| `:e 文件名` | 编辑另一个文件 |
| `:bn` | 切换到下一个缓冲区 |
| `:bp` | 切换到上一个缓冲区 |
| `:bd` | 关闭当前缓冲区 |
| `:ls` | 列出所有缓冲区 |
| `:sp 文件名` | 水平分割窗口并打开文件 |
| `:vsp 文件名` | 垂直分割窗口并打开文件 |
| `Ctrl+w h/j/k/l` | 在窗口间移动光标 |
| `Ctrl+w c` | 关闭当前窗口 |
| `Ctrl+w o` | 关闭除当前窗口外的所有窗口 |

### 标记和跳转

| 命令 | 动作 |
|------|------|
| `ma` | 在当前位置设置标记a |
| `'a` | 跳转到标记a所在行 |
| `` `a `` | 跳转到标记a的确切位置 |
| `:marks` | 显示所有标记 |
| `Ctrl+o` | 跳回到上一个位置 |
| `Ctrl+i` | 跳到下一个位置 |

### 宏录制

| 命令 | 动作 |
|------|------|
| `qa` | 开始录制宏a |
| `q` | 停止录制 |
| `@a` | 执行宏a |
| `@@` | 重复上一次执行的宏 |
| `数字@a` | 执行宏a多次 |

### 折叠

| 命令 | 动作 |
|------|------|
| `zf动作` | 创建折叠 |
| `zo` | 打开折叠 |
| `zc` | 关闭折叠 |
| `za` | 切换折叠状态 |
| `zR` | 打开所有折叠 |
| `zM` | 关闭所有折叠 |

## 执行外部命令 🖥️

| 命令 | 动作 |
|------|------|
| `:!命令` | 执行外部shell命令 |
| `:r !命令` | 将命令输出插入到当前位置 |
| `:shell` 或 `:sh` | 临时进入shell（输入exit返回vim） |
| `:%!命令` | 使用外部命令过滤整个文件 |

## 设置选项 ⚙️

| 命令 | 动作 |
|------|------|
| `:set number` 或 `:set nu` | 显示行号 |
| `:set nonumber` 或 `:set nonu` | 隐藏行号 |
| `:set hlsearch` | 高亮搜索结果 |
| `:set nohlsearch` | 不高亮搜索结果 |
| `:set ignorecase` 或 `:set ic` | 搜索时忽略大小写 |
| `:set wrap` | 自动换行 |
| `:set nowrap` | 不自动换行 |
| `:set tabstop=4` 或 `:set ts=4` | 设置制表符宽度为4 |
| `:set expandtab` 或 `:set et` | 将制表符转换为空格 |
| `:set autoindent` | 自动缩进 |

## 实用技巧 💡

### 1. 快速删除和修改

```
cw  - 删除从光标到单词结尾并进入插入模式
cc  - 删除整行并进入插入模式
c$  - 删除从光标到行尾并进入插入模式
ci" - 删除双引号内的内容并进入插入模式
ci( - 删除括号内的内容并进入插入模式
```

### 2. 可视模式选择

```
v   - 进入字符可视模式
V   - 进入行可视模式
Ctrl+v - 进入块可视模式
```

在可视模式下，可以使用导航命令选择文本，然后使用操作命令（如d、y、c等）对选中文本进行操作。

### 3. 查找和替换特殊字符

```
/\n  - 查找换行符
:%s/\t/    /g  - 将制表符替换为4个空格
```

### 4. 保存只读文件

```
:w !sudo tee %  - 使用sudo权限保存当前文件
```

### 5. 格式化代码

```
gg=G  - 格式化整个文件的缩进
```

## 常见问题解答 ❓

### 如何在Vi/Vim中复制粘贴到系统剪贴板？

在支持系统剪贴板的Vim版本中：
```
"+y  - 复制到系统剪贴板
"+p  - 从系统剪贴板粘贴
```

### 如何在Vi/Vim中撤销所有更改？

```
:e!  - 重新加载文件，放弃所有更改
```

### 如何在Vi/Vim中查找并替换多行文本？

使用可视模式选择多行，然后：
```
:'<,'>s/旧/新/g
```

### 如何在Vi/Vim中自动缩进代码？

```
:set autoindent
:set smartindent
```

## 练习题 🎯

1. 打开一个新文件，输入三行文本，然后保存为"practice.txt"。
2. 在文件中搜索特定单词，并将其替换为另一个单词。
3. 复制一行文本，并将其粘贴到文件末尾。
4. 使用可视模式选择多行文本，并将其删除。
5. 在Vi中执行外部命令"ls -la"，并将输出插入到当前文件中。

## 小贴士 💡

- 使用`:help 命令`获取任何命令的详细帮助
- 创建`~/.vimrc`文件自定义Vim配置
- 使用插件管理器（如Vundle、Vim-Plug）安装插件扩展功能
- 学习触摸打字可以大大提高Vi/Vim的使用效率
- 每天学习一两个新命令，逐步掌握Vi/Vim

通过掌握Vi/Vim编辑器，你将拥有一个强大的文本编辑工具，可以在任何Unix/Linux环境中高效工作。虽然学习曲线较陡，但投入的时间将获得丰厚的回报，特别是在需要远程编辑文件或在服务器环境中工作时。记住，熟能生巧，多练习是掌握Vi/Vim的关键！
